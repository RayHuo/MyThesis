\chapter{改进的程序分割方法}

本章首先对Lifschitz和Turner提出的分割集和程序分割理论进行分析，给出计算其定义的分割集的算法，然后分析了其分割集的局限性。
接着，本章提出了对分割集的扩展和新程序分割方法。
本章将分别给出正规逻辑程序和析取逻辑程序的新程序分割方法，然后提出强程序分割方法。
最后以正规逻辑程序为例，对新程序分割方法的计算复杂性进行分析，并指出主要性能瓶颈所在及改进思路。


\section{分割集的计算与扩展}

本节将对Lifschitz和Turner提出的分割集理论进行分析，然后基于他们对分割集的定义提出一个计算分割集的算法，并分析其分割集在一般ASP逻辑程序中的局限性。随后给出本文定义的新分割集。


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{分割集的计算}\label{section_3_1_2}

Lifschitz和Turner给出的分割集定义的直观含义是若分割集包含一个规则头部的某些原子，则包含该规则中的所有原子。
这样的性质保证了分割集$U$可以把原程序从结构上划分成独立的两部分。
而Lifschitz和Turner给出的分割集的定义实际上是一个验证型定义。
本节根据Lifschitz和Turner对分割集的定义和Ji(2010)指出的分割集性质\ref{p_splitting_set_1}给出了一个计算ASP逻辑程序的分割集的算法，为$Alogrithm~$\ref{LifschitzU}。
% 插入算法
\RestyleAlgo{ruled}\LinesNumbered\input{algorithm/LifschitzU.tex}

根据$Alogrithm~$\ref{LifschitzU}，给出以下命题：
\begin{proposition} \label{p_for_splitting_set}
	给定ASP逻辑程序$P$，记函数$Us(P)$的返回结果为$Us$，则有以下结论：
	\begin{itemize}
		\item $Us$中的元素都是$P$的分割集；	% soundness 返回的都是正确的
		\item $P$中的任意分割集$U$，满足$U \in Us$。	% completness 所有正确答案都会被返回。
	\end{itemize}
\end{proposition}


% 证明两点：
% 	1） Us(P)中的元素都是P的分割集；
%	2） P中不存在一个分割集U，有U \notin  Us
\begin{proof} \label{algorithm_splitting_set_proof}
	对于命题\ref{p_for_splitting_set}中的结论一，
	给定任意$U \in Us$，
	根据$Alogrithm~$\ref{LifschitzU}，用于初始化$U$的规则$r_1$，
	有$Atoms(r_1) \subseteq U$，故符合$head(r_1) \cap U \neq \emptyset$蕴涵$Atoms(r_1) \subseteq U$。
	对于规则$r_2 \in P'$，其中$P'=P~\backslash~\{ r_1 \}$，也符合若$head(r_2) \cap U \neq \emptyset$，则$Atoms(r_2) \subseteq U$。
	则对于任意规则$r \in P$均有$head(r) \cap U \neq \emptyset$蕴涵$Atoms(r) \subseteq U$。
	故任意$U \in Us$都是$P$的分割集。
	
	对于命题\ref{p_for_splitting_set}中的结论二，
	令$U$为$P$的一个分割集，故必存在规则$r_U \in P$，有$Atoms(r_U) \subseteq U$。而函数$Us(P)$会遍历$P$中的所有规则，所以必存在一个原子集$U' \in Us$满足$Atoms(r_U) \subseteq U'$。
	而且，对于任意规则$r' \in P \backslash \{r_U\}$满足：若$head(r') \cap U \neq \emptyset$，则$Atoms(r') \subseteq U'$。故有$U = U'$，所以必有$U \in Us$。 \quad		
\end{proof}
%	基于结论一可知$Us$中的元素都是$P$的分割集，而函数$Us(P)$会遍历$P$中的所有规则$r$，并以$Atoms(r)$作为开始进行扩充。另，根据分割集的定义可知，分割集$U$必包含某些规则的全部原子，故必有$U \in Us$中。\quad



下面给出一个调用函数$Us(P)$的例子：
\begin{example}
	给定ASP逻辑程序$P$：
	\begin{eqnarray}
		&& a \lor b~\leftarrow~c,~d.	\\
		&& a~\leftarrow~e,~b.	\\
		&& e~\leftarrow~f.	\\
		&& g~\leftarrow~h,~i.	\\
		&& g \lor h~\leftarrow~j,~k.	\\
		&& k~\leftarrow~i.	
	\end{eqnarray}
	
	通过$Alogrithm~$\ref{LifschitzU}可以得到：
	\begin{equation}
		Us(P)~=~\{ \{a,b,c,d,e,f\},~\{g,h,i,j,k\} \}
	\end{equation}
	
	根据定义\ref{splitting_set}可以判断得到$Us(P)$中的元素均为$P$的分割集，且$Us(P)$是$P$中所有分割集构成的集合。
\end{example}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{分割集的扩展}

Lifschitz和Turner所定义的分割集中的原子对应原程序正依赖图中结构独立的一个子图，根据命题\ref{p_splitting_set_1}，这样的子图对应的规则集合没有外部支持，所以在求解回答集上也是独立的。
然而，对于国际ASP竞赛\footnote[1]{https://www.mat.unical.it/aspcomp2013}中的大部分逻辑程序，其分割集都是$Atoms(P)$。
这样的事实表明，Lifschitz和Turner所定义的分割集于实际的ASP逻辑程序是存在局限性的。
%明显地，$\emptyset$和$Atoms(P)$都是任何ASP逻辑程序的分割集。
%而对于国际ASP竞赛\footnote[1]{https://www.mat.unical.it/aspcomp2013}中的大部分逻辑程序，其分割集都是$Atoms(P)$。
%这样的事实表明，Lifschitz和 \\ Turner所定义的分割集于实际的ASP逻辑程序是存在局限性的。
%分割集的原子对应原程序正依赖图中结构独立的一个子图，根据命题\ref{p_splitting_set_1}，这样的子图对应的规则集合没有外部支持，所以在求解回答集上也是独立的。
%%
%然而从ASP竞赛的逻辑程序的分割集情况可以知道，
实际中的ASP逻辑程序并非都具有如此性能优良的子图。

为了能让分割集的思想能应用到一般的情景下，本文对其Lifschitz和Turner的分割集进行了扩展。
事实上，本文并没有定义一个新的分割集，而是定义了一个新程序分割方法，并确保这个新的程序分割方法能对任意原子集构成的分割集都有效。
即新的分割集是任意原子集，摆脱了原有分割集对ASP逻辑程序在结构上的依赖。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FROM here
\section{新程序分割方法}

本节中将分别给出正规逻辑程序和析取逻辑程序的新程序分割方法，
这两者间的主要不同在于对$top$的定义，
这是由正规逻辑程序和析取逻辑程序的回答集语义所决定的。
在介绍正规逻辑程序的新程序分割方法过程中，本节会在定义操作符的同时给出其直观上的含义，
并通过相关的命题证明新程序分割方法能使用任意原子集构成的分割集对ASP逻辑程序进行分割，
并可根据分割后两部分的回答集求解得到原程序的回答集。
最后，本节会提出一个强程序分割方法，该方法是为了扩展新程序分割方法在结合律下的有效性。


\subsection{正规逻辑程序的新程序分割方法}

首先，本节将继续使用定义\ref{bottom_top}中的$b_U(P)$和定义\ref{e_U_P_X}中的操作$e_U(P,X)$，记ASP逻辑程序的分割集为$U$。而此时分割集$U$是任意的原子集，并不存在结构上的独立性，即：
\begin{equation}\label{independence}
	Atoms(b_U(P)) \subseteq U
\end{equation}

式(\ref{independence})不一定成立。可以更为直接地说，大部分情况下都不再成立。为了保证新程序分割方法的普遍适用性，本节考虑以下关系是成立的：
\begin{equation} \label{chap3_dependence}
	Atoms(b_U(P)) \nsubseteq U
\end{equation}

事实上，对于$Atoms(b_U(P)) \nsubseteq U$情况下有效的程序分割方法在$Atoms(b_U(P)) \subseteq U$情况下一样有效，因为附加操作都是为了保证最坏情况的。

对于Lifschitz和Turner定义的分割集，$G_P$关于$Atoms(b_U(P))$的子图保证了自身在结构上的独立性，即有：
\begin{equation}
	Atoms(b_U(P))~\cap~head(P~\backslash~b_U(P)) = \emptyset
\end{equation}

即若一个原子$a \in Atoms(b_U(P))$且$a \in \Gamma (P)$，那么$a$只会在$b_U(P)$中被推出。而对于$U$为任意原子集的情况下，有：
\begin{eqnarray}
	&& Atoms(b_U(P))~\backslash~U~\neq~\emptyset	\\
	&& Atoms(b_U(P))~\cap~head(P~\backslash~b_U(P)) \neq \emptyset
\end{eqnarray}

所以需要考虑$Atoms(b_U(P))~\backslash~U$这部分原子的真值可能性问题。显然，这部分原子的真值仅靠$b_U(P)$是无法确定的，因为它们可能是$P~\backslash~b_U(P)$中某个规则的头部，即可能会在$P~\backslash~b_U(P)$部分被推出为真。所以最直接的方法就是在$\Gamma (b_U(P))$中加入这部分原子的真值可能性的全排列组合。然而，这部分原子的真值也并非可以任意猜测，需要配合$b_U(P)$中的规则，所以本节定义了以下规则集合，来确保这些原子的真值在合理推导下被遍历。
\begin{definition} 
	规则集合$EC_U(P)$为$Atoms(b_U(P))~\backslash~U$中的原子的真值可能性提供补充规则，定义如下：
	\begin{equation}
		EC_U(P)~=~\{ p~\leftarrow~not~p'.~p'~\leftarrow~not~p.~|~p \in Atoms(b_U(P)) \backslash U \}
	\end{equation}
\end{definition}

$EC_U(P)$为$Atoms(b_U(P)) \backslash U$中的原子引入一组规则：
\begin{eqnarray}
	&& p~\leftarrow~not~p'.	\\
	&& p'~\leftarrow~not~p.
\end{eqnarray}

其中的$p'$其实代表的就是$\neg p$，上面一组规则在ASP逻辑程序中的含义是$p \lor not~p.$，
换句话说即，如果一个ASP逻辑程序只有这两个规则，那么它的回答集就是$\{ \{p\},\{p'\} \}$，
实际就是$\neg p$或$p$。接着，通过一个简单的例子来展现$EC_U(P)$的效果。
\begin{example}
	给定ASP逻辑程序$P_1$：
	\begin{eqnarray}
		&& a~\leftarrow~not~d.	\\
		&& d~\leftarrow~not~c.	\\
		&& c~\leftarrow~a.	\\
		&& a~\leftarrow~c,~d.
	\end{eqnarray}
	
	令$P_1$的分割集$U=\{a\}$，则有：
	\begin{equation}
		b_U(P_1)~=~\{ a~\leftarrow~not~d.~a~\leftarrow~c,~d. \}
	\end{equation}
	
	并求解得到$\Gamma (b_U(P_1)) = \{ \{a\}  \}$。而$Atoms(b_U(P_1 )) \backslash U = \{c,d\}$，所以根据定义有：
	\begin{equation}
		EC_U(P_1)~=~\{ d~\leftarrow~not~d'.~d'~\leftarrow~not~d.~c~\leftarrow~not~c'.~c'~\leftarrow~not~c. \}
	\end{equation}
	
	求解$b_U(P_1) \cup EC_U(P_1)$，得到：
	\begin{equation}
		\Gamma (b_U(P_1) \cup EC_U(P_1)) = \{ \{ a,c,d \}, \{ a,c,d' \}, \{ a,c',d' \}, \{ c',d \} \}
	\end{equation}
\end{example}

%因为$head(b_U(P)) \subseteq U$，而且$\Gamma (b_U(P)) \subseteq head(b_U(P))$，所以有$\Gamma (b_U(P)) \subseteq U$。
%$Atoms(b_U(P)) \backslash U$部分的原子真值则无法由$b_U(P)$确定，因为它们有可能被$P \backslash b_U(P)$中的规则推出。
让$b_U(P)$并上$EC_U(P)$能使得$Atoms(b_U(P))~\backslash~U$中原子的真值的有效可能性被加入到$b_U(P)$的回答集中。
如$\Gamma (b_U(P_1) \cup EC_U(P_1))$中只有$\{ c',d \}$而没有$\{a,c',d\}$，这是因为在$\{c',d \}$为真的情况下，原程序无法推出$a$为真。这就是本节定义$EC_U(P)$而没有直接往$b_U(P)$的回答集中遍历插入剩下原子的可能真值组合的原因。

定义新的$bottom$为$b_U(P) \cup EC_U(P)$，记$bottom$的一个回答集为$X$，$X \in \Gamma (b_U(P) \\ \cup EC_U(P))$，那么这时就有$X~\backslash~U \neq \emptyset$。

定义\ref{e_U_P_X}中的操作$e_U(P,X)$只会去掉所有形如$a$或$not~a$的文字，其中$a \in U$。
而实际上，在$Atoms(b_U(P))~\backslash~U \neq \emptyset $且$X \backslash U \neq \emptyset$的情况下，
需要在$P~\backslash~b_U(P)$中保证$Atoms(b_U(P))~\backslash~U$中的原子的真值确定性，
所以本节定义了一个新的规则集合$ECC_U(P,X)$以达到这个目的。
\begin{definition} \label{d_ecc_U_P}
	规则集合$ECC_U(P,X)$为$P~\backslash~b_U(P)$部分提供$Atoms(b_U(P))~\backslash~U$中原子的真值确定性，具体有：
	% 公式换行，手动地使用 \begin{array}
	\begin{equation}
		\begin{array}{rcl}
			ECC_U(P) = \{ \leftarrow~not~p.~|~p \in Atoms(b_U(P)) \backslash U~\mbox{且}~p \in X \} \\
			\cup \{ \leftarrow~p.~|~p \in Atoms(b_U(P)) \backslash U~\mbox{且}~p \notin X \}
		\end{array}
	\end{equation}
\end{definition}

对于$ECC_U(P,X)$直观上的功能就是保证在$P~\backslash~b_U(P)$中的每个原子$p$，
若$p \in X$，则要确保$p$为真，故往ASP逻辑程序中加入“$\leftarrow~not~p.$”；
若$p \notin X$，则要确保$p$为假，故往ASP逻辑程序中加入“$\leftarrow~p.$”。
基于这样的分析，可以得到以下命题。
\begin{proposition} \label{satisfy_proposition}
	已知$P$是一个正规逻辑程序，$U$是一个原子集。那么一个原子集$S \subseteq Atoms(P)$能满足$P$，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中的原子集$X$和$Y$分别有：
	\begin{itemize}
		\item $X \models b_U(P) \cup EC_U(P)$
		\item $Y \models e_U(P \backslash b_U(P),X) \cup ECC_U(P,X)$
	\end{itemize}
\end{proposition}

\begin{proof} \label{proof_satisfy_proposition}
	% 充分性证明	
	$(\Rightarrow)~$ 
	若有$X \models b_U(P) \cup EC_U(P)$及$Y \models e_U(P \backslash b_U(P),X) \cup ECC_U(P,X)$，则有：
	\begin{equation} \label{x_m_bup}
		X \models b_U(P)
	\end{equation}
	
	而$ECC_U(P,X)$保证了以下两点：
	\begin{itemize}
		\item 若原子$p \in (Atoms(b_U(P))~\backslash~U) \cap X$，则$p$为真；
		\item 若原子$p \in (Atoms(b_U(P))~\backslash~U)~\backslash~X$，则$p$为假。
	\end{itemize}
	
	$ECC_U(P,X)$确保了$Y$和$X$的一致性。且$e_U(P~\backslash~b_U(P), X)$仅对$P~\backslash~b_U(P)$中不会因$X$中的原子真值确定性而失去意义的规则操作，并仅会删去由$U$中原子导致为真的文字。所以有：
	\begin{equation} \label{xy_m_p_bup}
		(X \cup Y) \cap Atoms(P) \models P~\backslash~b_U(P)
	\end{equation}
	
	联合式(\ref{x_m_bup})和式(\ref{xy_m_p_bup})可以得到$(X \cup Y) \cap Atoms(P) \models P$。故充分性得证。
	
	% 必要性证明
	$(\Leftarrow)~$
	若$S \models P$，令$X = (S \cap U) \cup \{ a~|~a \in S \cap (Atoms(b_U(P))~\backslash~U) \} \cup \{ a'~|~a' \in Atoms(b_U(P)~\backslash~(U \cup S) \} $，$Y = S~\backslash~U$。显然有$(X \cup Y) \cap Atoms(P) = S$。
	
	由于$S \models P$，所以$\{ a~|~a \in S \cap (Atoms(b_U(P))~\backslash~U) \}$为$Atoms(b_U(P))~\backslash~U$中满足$P$的原子部分；$Atoms(b_U(P)~\backslash~(U \cup S)$则为$Atoms(b_U(P))~\backslash~U$中不满足$P$的原子部分。故有：
	\begin{equation} \label{x_m_bupecu}
		X \models b_U(P) \cup EC_U(P)
	\end{equation}
	
	另，$S \models P$，故$S \models P \backslash b_U(P)$。由前面的分析可知$e_U(P \backslash b_U(P),X)$仅删去受$U$中原子真值影响的文字，所以$Y \models e_U(P \backslash b_U(P),X)$。又$ECC_U(P,X)$保证的是若一个原子$p \in X~\backslash~U$，则$p$为真。$S$为$P$的模型，故$S~\backslash~U$能满足$ECC_U(P,X)$。故有：
	\begin{equation} \label{y_m_euecc}
		Y \models  e_U(P \backslash b_U(P),X) \cup ECC_U(P,X)
	\end{equation}

	由式(\ref{x_m_bupecu})和式(\ref{y_m_euecc})可知必要性成立。\quad
\end{proof}


%显然，依据定义$EC_U(P)$和$ECC_U(P,X)$过程中的分析便可以清楚地知道命题\ref{satisfy_proposition}是成立的。
接下来，本节给出一个验证命题\ref{satisfy_proposition}的例子。
\begin{example} \label{example_3_3}
	令$P_1$的分割集为$U=\{a\}$，那么可以计算得到：
	\begin{equation}
		b_U(P_1)~=~\{ a~\leftarrow~not~d.~a~\leftarrow~c,~d. \}
	\end{equation}
	
	及：
	\begin{equation}
		EC_U(P_1)~=~\{ d~\leftarrow~not~d'.~d'~\leftarrow~not~d.~c~\leftarrow~not~c'.~c'~\leftarrow~not~c. \}
	\end{equation}
	
	且求解得到：
	\begin{equation}
		\Gamma (b_U(P_1) \cup EC_U(P_1)) = \{ \{ a,c,d \}, \{ a,c,d' \}, \{ a,c',d' \}, \{ c',d \} \}
	\end{equation}
	
	令$X=\{a,c,d'\}$，显然，$X \models b_U(P_1 ) \cup EC_U(P_1)$。另，可以计算得到：
	\begin{equation}
		\begin{array}{rcl}
			e_U(P_1 \backslash b_U(P_1), X) = \{ d~\leftarrow~not~c.~c~\leftarrow. \}	\\
			ECC_U(P_1, X) = \{ \leftarrow~not~c.~\leftarrow~d. \}
		\end{array}
	\end{equation}
	
	并求解得到：
	\begin{equation}
		\Gamma (e_U(P_1 \backslash b_U(P_1), X)) = \{ \{ c \} \}
	\end{equation}
	
	令$Y=\{c\}$，显然，$Y \models e_U(P_1 \backslash b_U(P_1 ),X) \cup  ECC_U(P_1,X)$。
	$X \cup Y = \{a,c,d'\}$，明显也有$(X \cup Y) \cap Atoms(P) \models P_1$。
\end{example}

在引入了$EC_U(P)$和$ECC_U(P,X)$后，依据命题\ref{satisfy_proposition}，可以知道原程序的模型可以通过$bottom$和$top$两部分的模型计算得到。
然而，直接使用$P~\backslash~b_U(P)$作为$top$并不能求解出原程序剩下的回答集部分。
这是因为分割集$U$把逻辑程序$P$划分为$bottom$和$top$两部分的同时也可能会破坏了$P$中的某些环$L$。

接下来，本节将基于Lin和Zhao(2002)的环与环公式的思想，来定义可以用于求解原程序剩余回答集部分的$top$。
首先，这里定义两个规则集合。
\begin{definition} \label{in_out}
	对一个ASP逻辑程序$P$基于一个原子集$U$，定义以下两个规则集合：
	\begin{eqnarray}
		&& in_U(P) = \{ r \in P~|~head(r) \cap U \neq \emptyset,~(body^+(r) \cup head(r)) \nsubseteq U \}	\\
		&& out_U(P) = \{ r \in P~|~ head(r) \nsubseteq U,~(body^+(r) \cup head(r)) \cap U \neq \emptyset \}
	\end{eqnarray}
\end{definition}

$in_U(P)$和$out_U(P)$是与ASP逻辑程序正依赖图结构性相关的规则集合。在正规逻辑程序中直观的含义是：
$in_U(P)$代表了头部属于分割集$U$，而体部正原子存在与$U$中原子不同的原子的规则集合；
$out_U(P)$代表了头部不属于分割集$U$，而体部正原子存在与$U$中原子相同的原子的规则集合。
根据两者的定义，显然可以得到以下集合关系：
\begin{eqnarray}
	&& in_U(P) \subseteq b_U(P)	\\
	&& out_U(P) \subseteq P~\backslash~b_U(P)
\end{eqnarray}

在有了$in_U(P)$和$out_U(P)$的概念后，本节给出以下定义。
\begin{definition}[半环]  \label{semi_loop}
	称一个非空原子集$E$为ASP逻辑程序$P$基于原子集$U$的半环(semi-loop)，当且仅当在$P$中存在一个环$L$使得$E = L \cap U$且$E \subset L$。
\end{definition}

\begin{definition} \label{SLUP}
	给定正规逻辑程序$P$和原子集$X$、$U$和$E$，且$E$为$P$基于$U$的半环，定义一个半环集合如下：
	\begin{equation}
		SL_U(P,X) = \{ E~|~E \subseteq X,~R^-(E,P,X) \subseteq in_U(P) \}
	\end{equation}
\end{definition}

根据semi-loop和$SL_U(P,X)$的定义，可以得到以下引理。
\begin{lemma}\label{lem_slupx}
	给定正规逻辑程序$P$和其分割集$U$，原子集$X \in \Gamma (b_U(P) \cup EC_U(P))$，一个半环$E$属于$SL_U(P,X)$，则$P$中存在一个环$L$满足$E \subset L$且$X \nvDash LF(L,P)$。	
\end{lemma}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Continue From Here
\begin{proof}
	使用反证法。
	
	分割集$U$在把ASP逻辑程序$P$划分为两部分的同时可能会破坏$P$中的某些环$L$。这些被破坏的环可以分为两类：
	\begin{itemize}
		\item 该环的环公式已经被$bottom$部分的回答集$X$所满足；
		\item 该环的环公式不能被$bottom$部分的回答集$X$所满足。
	\end{itemize}
	
	对于ASP逻辑程序$P$中一个环$L$，其与分割集$U$的关系可以分为以下的情况：
	
	1） $L \subseteq U$。则对于规则$r \in R^-(L,P)$有$head(r) \cap L \neq \emptyset$，故$head(r) \cap U \neq \emptyset$，所以$r \in b_U(P)$，因此可以得到：
	\begin{equation}
		R^-(L, P) = R^-(L, b_U(P) \cup EC_U(P))
	\end{equation}
	
	故有：
	\begin{equation}
		LF(L,P) = LF(L, b_U(P) \cup EC_U(P))
	\end{equation}
	
	而$X \in \Gamma (b_U(P) \cup EC_U(P))$，所以有：
	\begin{equation}
		X \models LF(L, b_U(P) \cup EC_U(P))
	\end{equation}
	
	进而有：
	\begin{equation}
	X \models LF(L,P)
	\end{equation}
	
	2） $L \nsubseteq U$且$L \cap U = \emptyset$，即$L \subseteq Atoms(P)~\backslash~U$。这样的环$L$与$b_U(P)$无关，完全在$P~\backslash~b_U(P)$中。因为$L \cap U = \emptyset$，则$L \nsubseteq X$。根据环公式被一个原子集满足的定义可以知道$L \nsubseteq X$使得前键为假，故定义中的蕴涵式为真，即有$X \models LF(L,P)$。
	
	当环$L$完全在$b_U(P)$中时，或者环$L$完全在$P \backslash b_U(P)$中时，$X$能满足其环公式。实际上这样的环不属于被$U$破坏的环。以下情况的环为被$U$破坏的环。
	
	3） $L \nsubseteq U$且$L \cap U \neq \emptyset$。
	
	当$(L \cap U) \nsubseteq X$时，$L \nsubseteq X$，$X \models LF(L,P)$。
	
	当$(L \cap U) \subseteq X$时，若$L \nsubseteq X$，则也有$X \models LF(L,P)$。这两种即前面说到的环被破坏了，但$X$能满足其环公式的情况。
	
	若$L \subseteq X$时，若$R^-(L \cap U, P, X) \backslash in_U(P) \neq \emptyset$，即存在规则$r \in R^-(L \cap U, P, X) \backslash in_U(P)$，且有$R^-(L \cap U, P, X) \in b_U(P)$。
	
	对于$r \notin in_U(P)$，所以有$body^+(r) \subseteq U$。
	
	对于$r \in R^-(L \cap U, P, X)$，所以有$X \models body(r)$和$body^+(r) \cap (L \cap U) = \emptyset$，
	% 这里的推论，画个维恩图就很清晰了
	且已有$L \cap U \neq \emptyset$和$body^+(r) \subseteq U$，故$body^+(r) \cap L = \emptyset$。
	同时，$head(r) \cap (L \cap U) \neq \emptyset$，所以$head(r) \cap L \neq \emptyset$。
	故可以得到存在一个规则$r \in R^-(L,P)$且$X \models body(r)$，所以有$X \models LF(L,P)$。
	
	故令$E = L \cap U$，$E \subseteq X$，且有$R^-(E,P,X) \subseteq in_U(P)$时，就存在一个环$L$有$X \nvDash LF(L,P)$。\quad
\end{proof}

被分割集$U$破坏的环的环公式可能不能为$bottom$的回答集$X$所满足，所以需要剩下部分的回答集联合$X$一起去满足。定义$SL_U(P,X)$就是为了找出ASP逻辑程序$P$中被$U$破坏且环公式不能被$X$所满足的环。

根据上述的分析，引用Lin和Zhao(2002)提出的环理论，本节定义新的$top$的关键部分$t_U(P,X)$以保证$top$部分的回答集联合$X$能满足这部分环的环公式，进而保证ASP逻辑程序$P$中所有环的环公式都能被满足。
\begin{definition} \label{new_top}
	给定$P$为一个正规逻辑程序，$X$和$U$为原子集，$P$基于$U$通过$X$得到的一个规则集合记为$t_U(P,X)$，其由以下三部分组成：
	\begin{itemize}
		\item $P \backslash (b_U(P) \cup out_U(P))$，
		\item 对每个$E \in SL_U(P,X)$构造$\{ x_E~\leftarrow~body(r)~|~r \in in_U(P),~r \in R^-(E,P,X) \}$，
		\item $\{ head(r)~\leftarrow~x_{E_1},x_{E_2},...,x_{E_t},body(r)~|~r \in out_U(P),~E_i \in SL_U(P,X)(1 \leq i \leq t)~\mbox{且}~body^+(r) \cap E_i \neq \emptyset \}$。
	\end{itemize}
\end{definition}

其中$x_{E_i}$为基于$SL_U(P,X)$中的semi-loop引入的新原子，对于这些新原子，最后通过逻辑交$Atoms(P)$即可消去。
$t_U(P,X)$由三部分组成，其中第一部分从$P$中删去了$b_U(P)$和$out_U(P)$，
事实上，$b_U(P)$和$out_U(P)$不是被单纯地删去，
而是分别在$t_U(P,X)$的第二和第三部分根据$SL_U(P,X)$中的元素被进行重构，以此来补全那些被分割集$U$破坏了而$bottom$的回答集$X$不能满足其环公式的环。


在明确了$t_U(P,X)$的直观作用后，本节将对定义\ref{asp_solution}进行重定义，给出新的ASP逻辑程序$P$基于分割集$U$的方案。
\begin{definition}[方案] \label{new_solution}
	给定正规逻辑程序$P$和其分割集$U$，$P$基于$U$的方案(Solution)，是一组原子集$\langle X,Y \rangle$，其中：	
	\begin{itemize}
		\item $X$是$b_U(P) \cup EC_U(P)$的一个回答集；
		\item $Y$是$e_U(t_U(P,X),X) \cup ECC_U(P,X)$的一个回答集。
	\end{itemize}
\end{definition}

称$e_U(t_U(P,X),X) \cup ECC_U(P,X)$为新的$top$。下面给出一个计算ASP逻辑程序$P$基于其分割集$U$的方案的例子。
\begin{example}
	继续使用ASP逻辑程序$P_1$，并令分割集$U=\{a\}$，根据定义\ref{in_out}可以计算得到：
	\begin{eqnarray}
	&& in_U(P_1) = \{ a~\leftarrow~c,~d. \}	\\
	&& out_U(P_1) = \{ c~\leftarrow~a. \}
	\end{eqnarray}
	
	且可以从$P_1$中取环$L=\{a,c\}$，则有$E = L \cap U = \{a\}$，满足$E \subset L$。并由例\ref{example_3_3}已经算得：
	\begin{equation}
	\Gamma (b_U(P_1) \cup EC_U(P_1)) = \{ \{ a,c,d \}, \{ a,c,d' \}, \{ a,c',d' \}, \{ c',d \} \}
	\end{equation}
	
	这里，取$X = \{a,c,d'\}$和$X' = \{a,c,d\}$，那么可以计算得到：
	\begin{eqnarray}
	&& R^-(E,P_1,X) = \{ a~\leftarrow~not~d. \}	\\
	&& R^-(E,P_1,X') = \{ a~\leftarrow~c,~d. \}
	\end{eqnarray}
	
	则有：
	\begin{eqnarray}
	&& SL_U(P_1,X) = \emptyset	\\
	&& SL_U(P_1,X') = \{ \{a\} \}
	\end{eqnarray}
	
	并基于定义\ref{new_top}计算得到：
	\begin{eqnarray}
	&& t_U(P_1,X) = \{ d~\leftarrow~not~c.~c~\leftarrow~a. \}	\\
	&& t_U(P_1,X') = \{ d~\leftarrow~not~c.~x_{\{a\}}~\leftarrow~c,~d.~c~\leftarrow~x_{\{a\}},~a. \}
	\end{eqnarray}
	
	另外，有：
	\begin{eqnarray}
	&& ECC_U(P_1,X) = \{ \leftarrow~not~c.~\leftarrow~d. \}	\\
	&& ECC_U(P_1,X') = \{ \leftarrow~not~c.~\leftarrow~not~d. \}
	\end{eqnarray}
	
	通过求解器计算得到：
	\begin{eqnarray}
	&& \Gamma (e_U(t_U(P_1,X),X) \cup ECC_U(P_1,X)) = \{ \{c\} \}	\\
	&& \Gamma (e_U(t_U(P_1,X'),X') \cup ECC_U(P_1,X')) = \emptyset
	\end{eqnarray}
	
	其中$\langle X,\{c\} \rangle$为$P$基于$U$的一个方案。
\end{example}



%%%%%%%%%%%%%%%%%%%%%
根据引理\ref{lem_slupx}的证明可以知道$X$满足了大部分情况下的环公式，对于$X$所不能满足的环公式的情况是：环$L \subseteq X$，但不存在规则$r \in R^-(L,P)$且$X \models body(r)$。若有另一个原子集$Y$对这样的环都符合存在规则$r \in R^-(L,P)$且$Y \models body(r)$，则可以得到$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环的环公式。

令$Y$是$top$部分的回答集，所以$Y$只可能满足$r \in R^-(L,P)~\backslash~b_U(P)$中的某些$body(r)$。但无法直接判定$Y$能满足哪些$body(r)$。若能在$P~\backslash~b_U(P)$部分中构造关于$L~\backslash~U$的环，则有$R^-(L,P)~\backslash~b_U(P) \subseteq R^-(L \backslash U, t_U(P,X))$，而$Y$为$top$的回答集，构造关于$L \backslash U$的环在$top$内，必然存在规则$r \in R^-(L,P)~\backslash~b_U(P)$且$Y \models body(r)$。而事实上，$t_U(P,X)$达到了构造这样关于$L~\backslash~U$的环的目的。
%%%%%%%%%%%%%%%%%%%%%

根据上述的分析，本节可以得到以下命题。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proposition} \label{po_XY_satisfy_allLoop}
	给定ASP逻辑程序$P$及其分割集$U$，一组原子集$\langle X,Y \rangle$是$P$基于$U$的一组方案，
	则$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环的环公式。
\end{proposition}



%% 思路是可以通过$t_U(P,X)$构造出关于$L~\backslash~U$的环，
%% 然后$Y$满足这个环，
%% 然后通过$Y$满足这个环，再证明$(X \cup Y) \cap Atoms(P)$满足哪些不被$X$满足的环公式。
\begin{proof}\label{proof_top}
	%新的$top$的第一部分首先去除了$bottom$部分的规则，同时去除$out_U(P)$中的规则，待第二和第三部分重构。新的$top$是为了达到保证$(X \cup Y) \cap Atoms(P)$为$P$的回答集，首先证明$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环。
	%根据引理\ref{lem_slupx}的证明可以知道$X$满足了大部分情况下的环公式，对于$X$所不能满足的环公式的情况是：环$L \subseteq X$，但不存在规则$r \in R^-(L,P)$有$X \models body(r)$。若对这样的环都存在规则$r \in R^-(L,P)$有$Y \models body(r)$，则可以得到$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环的环公式。
	
	%而$Y$是$top$部分的回答集，所以$Y$只可能满足$r \in R^-(L,P) \backslash b_U(P)$中的某些$body(r)$。而无法直接判定$Y$能满足哪些$body(r)$。若能构建关于$L \backslash U$的环，则有$R^-(L,P) \backslash b_U(P) \subseteq R^-(L \backslash U, t_U(P,X))$，而$Y$为$top$的回答集，构造关于$L \backslash U$的环在$top$内，必然存在$r \in R^-(L,P) \backslash b_U(P)$有$Y \models body(r)$。
	
	对于$X$能满足的环，必然能被$(X \cup Y) \cap Atoms(P)$所满足。故这里考虑$P$中一个环$L$，其被$U$划分为两部分，构成环$L$的规则分别存在于$b_U(P)$和$P~\backslash~b_U(P)$两部分中，$L \subseteq X$但$X \nvDash LF(L,P)$。
	
	首先证明$t_U(P,X)$中的第二和第三部分能够在$P~\backslash~b_U(P)$中构造出关于$L~\backslash~U$的环。特别地，记$r_1 \in out_U(P)$和$r_2 \in in_U(P)$。
	
	对于第二部分中构造的规则“$x_E~\leftarrow~body(r_2)$”，其中$r_2 \in in_U(P)$且$r_2 \in R^-(E,P,X)$。由于$r_2 \in in_U(P)$，则有$head(r_2) \cap U \neq \emptyset$，故$r_2 \in b_U(P)$，而且$r_2 \in R^-(E,P,X)$，故有：
	\begin{equation}\label{head_r_2}
	head(r_2) \cap (L \cap U) \neq \emptyset
	\end{equation}
	\begin{equation}\label{body_r_2}
	body^+(r_2) \cap (L \cap U) = \emptyset
	\end{equation}
	
	因为$L$是$P$中的一个环，在构成$L$的规则$r$中，满足$head(r) \cap U \neq \emptyset$的规则$r$都在$b_U(P)$中，
	且在这些规则中必然存在规则$r_2$满足：
	\begin{equation} \label{body_p_r_2}
		body^+(r_2) \cap (L~\backslash~U) \neq \emptyset
	\end{equation}
	
	否则$P$中不会存在$L$这个环。对于每个满足$body^+(r_2) \cap (L~\backslash~U) \neq \emptyset$的规则$r_2$都会使用$E \in SL_U(P,X)$来构成一个形如$x_E~\leftarrow~body(r_2)$的新规则。
	此外，这些规则都是从$b_U(P)$中提取出来的，且保留了体部。而$X \in \Gamma (b_U(P) \cup ECC_U(P))$，故对于$r_2 \in b_U(P)$也必然符合$X \models body(r_2)$，不会与$r_2 \in R^-(E,P,X)$产生矛盾。
	
	对于第三部分中构造的规则“$head(r_1)~\leftarrow~x_{E_1},~x_{E_2},...,~x_{E_t},~body(r_1)$”，其中$r_1 \in out_U(P)$，所以有：
	\begin{equation}\label{body_r_1}
	body^+(r_1) \cap (L \cap U) \neq \emptyset
	\end{equation}
	
	而为了保证能构成$L$这个环，在$P \backslash b_U(P)$的规则中，对于满足$body^+(r_1) \cap (L \cap U) \neq \emptyset$的规则，必存在一个规则满足：
	\begin{equation}\label{head_r_1}
	head(r_1) \cap (L \backslash U) \neq \emptyset
	\end{equation}
	
	根据式子\ref{head_r_2}和\ref{body_r_1}，以及式子\ref{head_r_1}和\ref{body_p_r_2}，可以知道$(L~\backslash~U) \cup \{x_E\}$是一个环。即在$t_U(P,X)$中必能为被$U$破坏的环$L$构造出一个包含$L~\backslash~U$的环，该环就是$(L~\backslash~U) \cup \{x_E\}$。
	
	% 这里说明的其实就是构建的(L~\backslash~U) \cup \{x_E\}这个环的某些外部支持必然是L原来的外部支持（用P_1作为例子，一目了然）。然后Y作为t_U(P,X)的回答集，必然也是满足这部分的，所以Y能满足L的某个外部支持的body，而此时X已经包含了L，故X \cup Y也包含L，且满足其外部支持的一个body，故满足L的环公式。
	另，必然存在规则$r_s \in R^-((L~\backslash~U) \cup \{x_E\},P)$满足$body^+(r_s) \cap L = \emptyset$，即$r_s \in R^-(L,P)$，而$Y$作为$top$的回答集，必然有$Y \models body(r_s)$，此时基于$L \subseteq X$进行讨论，故有$L \subseteq (X \cup Y) \cap Atoms(P)$，所以$(X \cup Y) \cap Atoms(P) \models LF(L,P)$。
	
	此外，$e_U(P,X)$只会删去$U$相关的原子，$ECC_U(P,X)$只包含约束，约束不会是构成环的规则，故这两个操作都不会影响环$(L~\backslash~U) \cup \{x_E\}$的某个外部支持的体部被$Y$所满足这个事实。
	
	综合上面的证明，可以得到$(X \cup Y) \cap Atoms(P)$能满足那些被$U$破坏且$X$无法满足的环公式，故$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环公式。 \quad
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%% proof top


明确命题\ref{po_XY_satisfy_allLoop}的正确性后，本节提出一个引理，具体如下：
\begin{lemma}\label{lemma_3_1}
	给定一个正规逻辑程序$P$和其分割集$U$，如果$\langle X,Y \rangle$是$P$基于$U$的一组方案，且$SL_U(P,X) = \emptyset$，那么$(X \cup Y) \cap Atoms(P)$是$P$的一个回答集。
\end{lemma}

\begin{proof}
	根据前面已提及的$SL_U(P,X)$的属性可知，如果$SL_U(P,X) = \emptyset$时，可以得到：在$P$中不存在环$L$同时满足以下三点：
	\begin{itemize}
		\item $L \cap U = \emptyset$，
		\item $L \cap (Atoms(P) \backslash U) \neq \emptyset$，
		\item $X \cup Y \nvDash LF(L,P)$。
	\end{itemize}
	
	所以可以进一步得到$(X \cup Y) \cap Atoms(P)$满足$P$中的所有环公式。而命题\ref{satisfy_proposition}中指出$(X \cup Y) \cap Atoms(P)$是$P$的模型，联合Lin和Zhao(2002)的环理论，即定理\ref{Lin_Zhao_loop_theorem}，可以知道$P$的模型若能满足$P$中所有环公式，则该模型是$P$的一个回答集，所以可以得到$S = (X \cup Y) \cap Atoms(P)$是$P$的一个回答集。\quad
\end{proof}


%%%						新分割集理论								%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
更进一步地，本节依据新程序分割方法，得到以下定理。
\begin{theorem}[新分割理论]\label{new_splitting_theorem}
	已知正规逻辑程序$P$和任意原子集$U$，一个原子集$S$是$P$的回答集，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中$\langle X,Y \rangle$是$P$基于$U$的某组方案。
\end{theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{proof}\label{proof_new_splitting_theorem}
	%%%% 充分性
	$(\Rightarrow) \space$ 即证明当$X$和$Y$是$P$基于$U$的一组方案时，$(X \cup Y) \cap Atoms(P)$是$P$\\的回答集。
	而根据命题\ref{po_XY_satisfy_allLoop}可以知道有$(X \cup Y) \cap Atoms(P)$能满足$P$中的所有环公式。
	故只需证明$(X \cup Y) \cap Atoms(P)$满足$P$即可。
	
	1）已知$X$是$b_U(P) \cup EC_U(P)$的回答集，
	$EC_U(P)$会为$X$引入$Atoms(P)$以外的新原子，
	所以有$X \cap Atoms(P)$满足$b_U(P)$中的所有规则。
	
	2）已知$Y$是$e_U(t_U(P,X),X) \cup ECC_U(P,X)$的回答集。
	并且在$e_U(t_U(P,X),X) \cup ECC_U(P,X)$中引入的新原子$x_E$满足$\{ x_E~|~E \in SL_U(P,X) \} = Y~\backslash~Atoms(P)$，
	且$ECC_U(P,X)$确保了在$X$中的原子均为真。则有$Y$满足$e_U(P \backslash b_U(P),X)$中的所有规则。
	而$e_U(P,X)$只对$U$中的原子进行删减操作，
	所以有$(X \cup Y) \cap Atoms(P)$满足$P \backslash b_U(P)$。
	
	综合上面两个情况，可以有$(X \cup Y) \cap Atoms(P)$满足$P$。
	所以有$(X \cup Y) \cap Atoms(P)$是$P$的回答集。故充分性成立。
	
	
	
	%%% 必要性
	$(\Leftarrow) \space$ 即证明当原子集$S$是$P$的回答集时，存在$X$和$Y$是$P$基于$U$的一组方案，同时有$S = (X \cup Y) \cap Atoms(P)$。令：
	\begin{equation}
		\begin{array}{rcl}
			X = (S \cap U) \cup \{ a~|~a \in (S \cap Atoms(b_U(P))~\backslash~U) \} \\
			\cup \{ a'~|~a' \in Atoms(b_U(P))~\backslash~(U \cup S) \}
		\end{array}
	\end{equation}
	\begin{equation}
		Y = (S~\backslash~U) \cup \{ x_E~|~E \in SL_U(P,X) \}
	\end{equation}
	
	
	显然有$(X \cup Y) \cap Atoms(P) = S$，接着证明$\langle X, Y \rangle$是$P$基于$U$的一组方案。
	
	首先证明$X$是$b_U(P) \cup EC_U(P)$的回答集。
	因为$S$是$P$的回答集，所以$X$中的$(S \cap U) \cup \{ a~|~a \in (S \cap Atoms(b_U(P)) \backslash U) \}$部分就是$Atoms(b_U(P))$中属于$P$某个回答集的原子部分，
	$\{ a'~|~a' \in Atoms(b_U(P)) \backslash (U \cup S) \}$部分就是$Atoms(b_U(P))$中不属于$P$任意回答集的原子部分，
	故可以有$X$满足$b_U(P) \cup EC_U(P)$。
	而对于任意$b_U(P) \cup EC_U(P)$中的环$L$，由于任意规则$r \in EC_U(P)$都有$body^+(r) = \emptyset$，所以这部分不会产生环，
	故$Atoms(L) \subseteq Atoms(b_U(P))$，所以有$R^-(L, b_U(P) \cup EC_U(P)) = R^-(L,P)$。
	又由于$S$满足$P$中的所有环公式$LF(L,P)$，所以$X$满足$b_U(P) \cup EC_U(P)$中的所有环公式$LF(L,b_U(P) \cup EC_U(P))$。
	故$X$是$b_U(P) \cup EC_U(P)$ \\ 的回答集。
	
	接着证明$Y$是$e_U(t_U(P,X),X) \cup ECC_U(P,X)$的回答集。
	$\{x_E~|~E \in SL_U(P,X)\}$\\是用于在$t_U(P,X)$中构造环的，
	而且这些环$(L~\backslash~U) \cup \{x_E\}$和
	满足$Atoms(L~\backslash~U) \subseteq Atoms(P~\backslash~b_U(P))$的环$L \backslash U$都需要被满足，故$x_E$必在$top$部分的回答集中，
	而$S$为$P$的回答集，所以能够得到$Y$满足$e_U(t_U(P,X),X) \cup ECC_U(P,X)$中的所有规则。
	
	接着证明$Y$满足$e_U(t_U(P,X),X) \cup ECC_U(P,X)$中的所有环公式。
	根据前面的分析可知，$e_U(t_U(P,X),X) \cup ECC_U(P,X)$中的环分为两种情况。
	
	% U中原子作为头部的rule只在b_U(P)中，只有头部的原子才能作为回答集，所以 S \ U 就是 P \ b_U(P) 部分的回答集，故必会满足完全在P \ b_U(P)中的环公式。
	1）$L \subseteq Atoms(P) \backslash U$，即原程序$P$中本来就在$P \backslash b_U(P)$中的环。即不存在$x_E \in L$。这种情况下的环，由于$L \cap U = \emptyset$，故$e_U(t_U(P,X),X)$只删去$U$中相关原子，同时，$ECC_U(P,X)$只有约束规则，不会产生环。所以两种情况都不会影响到$L$。而$t_U(P,X)$中的第二部分只对满足$head(r) \cap U \neq \emptyset$的规则进行修改，故也不对$L$造成影响。而$S$是原程序$P$的回答集，$S~\backslash~U$为$P~\backslash~b_U(P)$部分的回答集，且$L \cap U = \emptyset$，故$S \backslash U$可以满足这些环的环公式。那么显然地，$Y$也能满足这些环的环公式。
	
	2）当存在$x_E \in L$时，根据前面的结论可知，含有$x_E$的环$L$都为了原程序中被$U$分割开且环公式不为$X$所满足的环$L'$而构造的。且构造的新环为$L = (L' \backslash U) \cup \{ x_E \}$。若$Atoms((L' \backslash U) \cup \{ x_E \}) \nsubseteq (S \backslash U) \cup \{ x_E \}$（即$Y$），则根据环公式被满足的定义有$Y$满足该环公式。若$Atoms((L' \backslash U) \cup \{ x_E \}) \subseteq (S \backslash U) \cup \{ x_E \}$，而$S$为原程序$P$的回答集，所以$S$满足$P$中所有的环公式。且$(L' \backslash U) \cup \{ x_E \}$在$P \backslash b_U(P)$的外部支持也是$L'$的外部支持。故$(S \backslash U)$也满足$(L' \backslash U) \cup \{ x_E \}$的某个外部支持。所以$(S \backslash U) \cup \{ x_E \}$，即$Y$满足$e_U(t_U(P,X),X) \cup ECC_U(P,X)$中的所有环公式。
	
	所以$Y$是$e_U(t_U(P,X),X) \cup ECC_U(P,X)$的回答集。
	故必要性成立。\quad
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%  证明新的分割理论的正确性  %%%%%%%%%%%%%%%%%%%%%%%%


在定理\ref{new_splitting_theorem}中给出的新分割理论在内容上跟Lifschitz和Turner当初提出的分割理论是类似的。
本质上的不同在于定义来计算$P$基于$U$的方案$\langle X,Y \rangle$的运算符被重新定义了，及此时的分割集$U$是一个任意的原子集。


半环集$SL_U(P,X)$根据Lin和Zhao(2002)的环理论，定义了让$bottom$的回答集$X$所不能满足的环公式的环与分割集的交集所构成的半环集。
定义这个半环集的目的就是为了依据它们构造出能保证$X$为真的规则，同时补全好被$X$破坏了的环。
更进一步地，基于Ji和Wan等(2014)的特征环的思想，可以想象得到并非所有的半环都是必要的，
本文在此根据Ji和Wan等(2014)中的思想，提取出必要的半环，定义一个$SL_U(P,X)$的子集以指代必要的半环集合。
\begin{definition}[关键半环] \label{dominated_semi_loop}
	给定正规逻辑程序$P$和原子集$U$，
	称一个半环$E$能代表另一个半环$E'$，
	当且仅当$E' \subseteq E$，且有$E' \cap head(in_U(P)) = E \cap head(in_U(P))$，以及$E' \cap body^+(out_U(P)) = E \cap body^+(out_U(P))$。
	若一个半环$E$，不存在其他半环能代表它，则称$E$为关键半环(Dominated Semi-loop)。
\end{definition}


根据关键半环的特性，对于关键半环$E$和任意一个$E$所能代表的半环$E'$，记$L$为$top$中与$E$相关的环，$L'$为$top$中与$E'$相关的环，那么$LF(L, t_U(P,X))$能推出$LF(L',t_U(P,X))$。

由于关键半环能够代替其他半环，所以这里定义一个关键半环的集合。
\begin{definition}[关键半环集]\label{DSL_U_PX}
	给定析取逻辑程序$P$和原子集$U$，$P$关于$U$的关键半环集记为$DSL_U(P,X)$，并定义为以下集合：
	\begin{equation}
		\begin{array}{rcl}
			DSL_U(P,X) = \{ E~|~E \in SL_U(P,X)~\mbox{且不存在另外一个}~\\
			E' \in SL_U(P,X)~\mbox{满足}~E' \mbox{能代表} E \} 
		\end{array}
	\end{equation}		
\end{definition}

显然，$DSL_U(P,X) \subseteq SL_U(P,X)$。同时，本节在此提供一个计算$DSL_U(P,X)$ \\ 的算法$Algorithm~$\ref{DSLUPX}，并有以下命题。

% 插入算法
\RestyleAlgo{ruled}\LinesNumbered\input{algorithm/DSLUPX.tex}

\begin{proposition} \label{prop_dslUPX}
	给定一个ASP逻辑程序$P$和一个原子集$X$，记$Algorithm~$\ref{DSLUPX}中的函数$dsl_U(P,X)$返回的结果为$dsl$，则有：
	\begin{itemize}
		\item $dsl$中的元素都是$P$基于$X$的关键半环；
		\item $P$基于$X$的任意关键半环$E$，满足$E \in dsl$。
	\end{itemize}
\end{proposition}

\begin{proof} \label{prof_dslUPX}
	对于命题\ref{prop_dslUPX}中的结论一，
	根据$DSL_U(P,X)$的定义可知，只需关注$head(in_U(P))$和$body^+(out_U(P))$。
	故$dsl_U(P,X)$在最外层对$head(in_U(P))$和 \\
	$body^+(out_U(P))$的所有非空子集进行遍历。
	$dsl_U(P,X)$把原程序$P$中的原子分为两部分：
	\begin{itemize}
		\item $AP_1 = Atoms(P) \backslash (head(in_U(P)) \cup body^+(out_U(P)))$
		\item $AP_2 = head(in_U(P)) \cup body^+(out_U(P))$
	\end{itemize}
	
	然后，$dsl_U(P,X)$基于$AP_1 \cup S_1 \cup S_2$从$G_P$中提取子图$G^S_P$，
	并查找$G^S_P$中包含$S_1 \cup S_2$的强连通分量$L$。
	强连通分量保证其是一系列环中在集合意义上是最大的一个，
	同时根据其满足$S_1 \cup S_2 \subseteq L$，
	所以$L$的任意非空子集$L'$都满足：
	\begin{equation} \label{l_e_head_in}
		L' \cap head(in_U(P)) \neq \emptyset~\mbox{且}~L' \cap head(in_U(P)) = L \cap head(in_U(P))
	\end{equation}	
	\begin{equation} \label{l_e_body_out}
		L' \cap body^+(out_U(P)) \neq \emptyset~\mbox{且}~L' \cap body^+(out_U(P)) = L \cap body^+(out_U(P))
	\end{equation}
	
	故这样的强连通分量$L$若不存在，则可以跳过当前的$G^S_P$子图，继续尝试下个子图。如果存在强连通分量$L$，则进一步判断其是否满足以下条件，以确定当前的$L$是否$SL_U(P,X)$中的元素。
	\begin{equation}\label{slupx_conditions}
		L \cap U \subseteq X~,~R^-(L \cap U, P, X) \subseteq in_U(P)
	\end{equation}
	
	如果满足条件，则$L \cap U$是$DLS_U(P,X)$中的元素，
	且前面有$L$是$SCC$，且$L$满足式\ref{l_e_head_in}和\ref{l_e_body_out}，则$L$是一个关键半环。
	同时$dsl_U(P,X)$把$L$加入到$dsl$中，故$dsl$中的元素都是关键半环。
	

	对于命题\ref{prop_dslUPX}中的结论二，
	在$dsl_U(P,X)$中，如果$L$不符合条件\ref{slupx_conditions}，则$L \notin SL_U(P,X)$，而$dsl_U(P,X)$会继续找出导致不满足条件\ref{slupx_conditions}的原子集$S$，如下：
	\begin{equation}
		S = head(R^-(L \cap U, P, X) \backslash in_U(P)) \cup ((L \backslash U) \backslash X)
	\end{equation}
	
	令$G^S_P$是$G_P$关于$L~\backslash~S$的子图，即可能满足条件\ref{slupx_conditions}的原子子图。并从该子图中重复寻找强连通分量$L$及判断其是否满足条件的过程。故所有可能构成关键半环的$SCC$的环都会被$dsl_U(P,X)$遍历，并且判断其符合关键半环条件时，加入到$dsl$中。
	故$P$基于$X$的任意关键半环$E$，都满足$E \in dsl$。
	\quad
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 算法分析
%以下是关于上述算法的分析：
%
%根据$DSL_U(P,X)$的定义可知，只需关注$head(in_U(P))$和$body^+(out_U(P))$，因为只有这两部分会影响环公式能否被满足。
%故上述算法最外层对$head(in_U(P))$和 \\
%$body^+(out_U(P))$的所有非空子集进行遍历。
%算法把原程序$P$中的原子分为两部分：
%\begin{itemize}
%	\item $AP_1 = Atoms(P) \backslash (head(in_U(P)) \cup body^+(out_U(P))$
%	\item $AP_2 = head(in_U(P)) \cup body^+(out_U(P)$
%\end{itemize}
%
%算法基于$AP_1 \cup S_1 \cup S_2$从$P$的正依赖图$G_P$中提取子图$G^S_P$，
%并查找$G^S_P$中包含$S_1 \cup S_2$的强连通分量（$SCC$）$L$。
%强连通分量保证其是一系列环中在集合意义上是最大的一个，
%同时根据其满足$S_1 \cup S_2 \subseteq L$，
%所以$L$的任意非空子集$E$都满足：
%\begin{itemize}
%	\item $E \cap head(in_U(P)) \neq \emptyset~,~E \cap head(in_U(P)) = L \cap head(in_U(P))$
%	\item $E \cap body^+(out_U(P)) \neq \emptyset~,~E \cap body^+(out_U(P)) = L \cap body^+(out_U(P))$
%\end{itemize}
%
%故这样的强连通分量$L$若不存在，则可以跳过当前的$G^S_P$子图，继续尝试下个子图。如果存在强连通分量$L$，则进一步判断其是否满足以下条件，以确定当前的$L$是否$SL_U(P,X)$中的元素。
%\begin{equation}\label{slupx_conditions}
%	L \cap U \subseteq X~,~R^-(L \cap U, P, X) \subseteq in_U(P)
%\end{equation}
%
%如果满足条件，则$L \cap U$是$DLS_U(P,X)$中的元素，加入到$dsl$中。如果不满足，找出导致不满足$SL_U(P,X)$条件的原子：
%\begin{equation}
%	S = head(R^-(L \cap U, P, X) \backslash in_U(P)) \cup ((L \backslash U) \backslash X)
%\end{equation}
%
%令$G^S_P$是$G_P$关于$L \backslash S$的子图，即可能满足条件\ref{slupx_conditions}的原子子图。并从该子图中重复寻找强连通分量$L$及判断其是否满足条件的过程。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



基于$DSL_U(P,X)$，本节定义关键顶部和关键方案。
\begin{definition}[关键顶部]
	给定$P$为一个正规逻辑程序，$X$和$U$为原子集，$P$基于$U$通过$X$得到的关键顶部(Dominated Top)记为$dt_U(P,X)$，其由以下三部分组成：
	\begin{itemize}
		\item $P \backslash (b_U(P) \cup out_U(P))$，
		\item 对每个$E \in DSL_U(P,X)$构造$\{ x_E~\leftarrow~body(r)~|~r \in in_U(P),~r \in R^-(E,P,X) \}$，
		\item $\{ head(r)~\leftarrow~x_{E_1},x_{E_2},...,x_{E_t},body(r)~|~r \in out_U(P),~E_i \in DSL_U(P,X)(1 \leq i \leq t)~\mbox{且}~body^+(r) \cap E_i \neq \emptyset \}$。
	\end{itemize}
\end{definition}

\begin{definition}[关键方案]
	给定正规逻辑程序$P$和其分割集$U$，$P$基于$U$的关键方案(Dominated Solution)，是一组原子集$\langle X,Y \rangle$，其中：	
	\begin{itemize}
		\item $X$是$b_U(P) \cup EC_U(P)$的一个回答集；
		\item $Y$是$e_U(dt_U(P,X),X) \cup ECC_U(P,X)$的一个回答集。
	\end{itemize}
\end{definition}

显然，它们的具体内容就是通过把之前定义的顶部和方案中的$SL_U(P,X)$替换为$DSL_U(P,X)$。最后本节扩展新的分割集理论，得到以下定理。
\begin{theorem}\label{new_d_splitting_theorem}
	给定一个正规逻辑程序$P$和原子集$U$，一个原子集$S$是$P$的一个回答集，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中$\langle X,Y \rangle$是$P$基于$U$的某组关键方案。
\end{theorem}

\begin{proof}
	由于关键半环在$top$中对应的环的环公式能推出其代表的半环对应的环的环公式。联合定理\ref{new_splitting_theorem}及Lin和Zhao(2002)的环理论，可以得到定理\ref{new_d_splitting_theorem}成立。
	\quad
\end{proof}

新程序分割方法对于$bottom$部分，通过定义$EC_U(P)$来补充$Atoms(b_U(P)) \backslash U$中原子的真值的可能性，以保证这部分原子不会被忽略。

对于$top$部分，定义了$ECC_U(P,X)$以确保$Atoms(top) \cap \Gamma (bottom)$这部分原子必为真。
同时使用Lin和Zhao(2002)的环理论，引入semi-loop的集合$SL_U(P,X)$，其代表的是环公式不能被底部回答集所满足的环所相关的semi-loop集合。基于$SL_U(P,X)$和原来的$P \backslash b_U(P)$来构建出新的$top$，即定义\ref{new_top}中的$t_U(P,X)$。

在上述的定义和分析证明过程中可以知道新程序分割方法能对任意原子集构成的分割集都有效。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{析取逻辑程序分割方法}

本节将把新程序分割方法从正规逻辑程序扩展到析取逻辑程序。由于之前所定义下的规则集合都是基于一般规则所定义的，所以对于析取逻辑程序，这些规则集合的操作符依旧有用。

具体地，$b_U(P)$，$e_U(P,X)$，$EC_U(P)$，$ECC_U(P,X)$，$in_U(P)$，$out_U(P)$，\\ $SL_U(P,X)$和$DSL_U(P,X)$都保持原来的定义不变。跟正规逻辑程序有所不同的是，在析取逻辑程序中，$in_U(P) \cap out_U(P) \neq \emptyset$。
在明确了需要用到的基本概念后，本节将重新定义析取逻辑程序的$top$的关键部分。

\begin{definition}[析取逻辑程序的顶部]\label{dlp_top}
	给定一个析取逻辑程序$P$和原子集$X$、$U$，$P$基于$U$关于$X$的$top$记为$dlpt_U(P,X)$，并由以下三部分组成：
	\begin{itemize}
		\item $P \backslash (b_U(P) \cup out_U(P)$，
		\item 对于每个$E \in SL_U(P,X)$构造$\{ \{x_E\} \cup head(r) \backslash E~\leftarrow~body(r)~|~r \in in_U(P)~\mbox{且} \\ r \in R^-(E,P,X) \}$，
		\item $\{ head(r)~\leftarrow~x_{E_1},x_{E_2},...,x_{E_t},body(r)~|~r \in out_U(P),~E_i \in SL_U(P,X)(1 \leq i \leq t)~\mbox{且}~body^+(r) \cap E_i \neq \emptyset \}$。
	\end{itemize}
\end{definition}

根据析取逻辑程序的$top$的定义，可以得到以下命题。
\begin{proposition} \label{prop_dlp_top}
	给定一个析取逻辑程序$P$，及其分割集$U$和其$bottom$部分的回答集$X$，环$L$有$L \subseteq X$且$X \nvDash LF(L,P)$，则$dlpt_U(P,X)$中的能构成环$(L~\backslash~U) \cup \{x_E\}$，其中$E \in SL_U(P,X)$。
\end{proposition}

%这里给出如此定义析取逻辑程序的$t_U(P,X)$的有效性的证明。
\begin{proof}\label{proof_dlp_top}
	显然，$dlpt_U(P,X)$与正规逻辑程序的$t_U(P,X)$的差别只在第二部分。
	在正规逻辑程序中，对于$head(r) \cap E \neq \emptyset$的情况下，由于$|head(r)| = 1$，所以实际为$head(r) \in E$。故在正规逻辑程序的$t_U(P,X)$的第二部分直接用$x_E$替换原来的$hear(r)$即可。而在析取逻辑程序中$|head(r)| \geq 1$，所以不能直接用$x_E$替换原来的$hear(r)$。而是直接把$head(r) \cap E$部分替换为$x_E$，故头部修正为$\{x_E\} \cup (head(r) \backslash E)$。
	
	同时，由于$x_E$的存在，且第三部分中规则的$head(r)$本来就不需要修改，故依旧能保持环$(L~\backslash~U) \cup \{x_E\}$的构成。此外，构成$(L \backslash U) \cup \{ x_E \}$环后的有效性跟正规逻辑程序一致。\quad
\end{proof}

\begin{example}
	给定原子集$U = \{a\}$，及析取逻辑程序$P_2$：
	\begin{eqnarray}
	&& a \lor d~\leftarrow~.	\\
	&& d~\leftarrow~not~c.		\\
	&& a~\leftarrow~c,~d.		\\
	&& c~\leftarrow~a.
	\end{eqnarray}
	
	可以计算得到：
	\begin{eqnarray}
		&& b_U(P_2) = \{ a \lor d~\leftarrow~.~a~\leftarrow~c,~d. \} \\
		&& EC_U(P_2) = \{ c~\leftarrow~not~c'.~c'~\leftarrow~not~c.~d~\leftarrow~not~d'.~d'~\leftarrow~not~d. \}
	\end{eqnarray}
	
	求解得到：$X=\{a,c,d\} \in \Gamma (b_U(P_2) \cup EC_U(P_2))$。$L = \{a,c\}$是$P_2$中的环，故有semi-loop $E = \{a\}$，并计算得到：
	\begin{eqnarray}
		&& ECC_U(P_2,X) = \{ \leftarrow~not~c.~\leftarrow~not~d. \}	\\
		&& R^-(E,P_2,X) = \{ a~\leftarrow~c,~d. \}	\\
		&& SL_U(P_2,X) = \{ \{a\} \}
	\end{eqnarray}
	
	进而得到：
	\begin{equation}
		dlpt_U(P_2,X) = \{ d~\leftarrow~not~c.~x_{\{a\}}~\leftarrow~c,~d.~c~\leftarrow~x_{\{a\}},~a. \}
	\end{equation}
\end{example}

根据析取逻辑程序的$top$，同样可以定义析取逻辑程序的方案，如下：
\begin{definition}[析取逻辑程序的方案] \label{def_dlp_solution}
	给定析取逻辑程序$P$和其分割集$U$，$P$基于$U$的方案，是一组原子集$\langle X,Y \rangle$，其中：	
	\begin{itemize}
		\item $X$是$b_U(P) \cup EC_U(P)$的一个回答集；
		\item $Y$是$e_U(dlpt_U(P,X),X) \cup ECC_U(P,X)$的一个回答集。
	\end{itemize}
\end{definition}


通过上述分析，本节给出析取逻辑程序在程序分割理论下的回答集定理。
\begin{theorem}\label{dlp_splitting_theorem}
	给定析取逻辑程序$P$和原子集$U$，一个原子集$S$是$P$的一个回答集，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中$\langle X,Y \rangle$是$P$基于$U$的某组方案。
\end{theorem}

\begin{proof}
	联合命题\ref{prop_dlp_top}和定理\ref{new_splitting_theorem}的证明可以直接地得到定理\ref{dlp_splitting_theorem}的正确性。
	\quad
\end{proof}

此外，对于析取逻辑程序，同样可以在$dlpt_U(P,X)$中使用$DSL_U(P,X)$代替$SL_U(P,X)$，并能取得与正规逻辑程序类似的效果。





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{强程序分割方法}

在Lifschitz和Turner的分割理论中，分割集U把ASP逻辑程序$P$分割为$b_U(P)$和\\ $P \backslash b_U(P)$两部分。
这个特点除了可以得到定理\ref{lifschitz_splitting_theorem}之外，还能引申出来其他的结论。对此，本节总结出如下命题。
\begin{proposition}\label{proposition_3_2}
	给定ASP逻辑程序$P$，原子集$U$是$P$在Lifschitz和Turner的分割理论定义下的分割集。另有ASP逻辑程序$P'$满足$Atoms(P') \cap U = \emptyset$，则原子集$S$是$P \cup P'$的一个回答集，当且仅当$S = X \cup Y$，其中$X$为$b_U(P)$的某个回答集，$Y$为$e_U(P \backslash b_U(P),X) \cup P'$的某个回答集。
\end{proposition}

\begin{proof}
	由于$Atoms(P') \cap U = \emptyset$，且$\Gamma (b_U(P)) \subseteq U$，所以$\Gamma (P') \cap \Gamma (b_U(P)) = \emptyset$，同时有$\Gamma (P') \cap U = \emptyset$。所以$P \cup P'$中划分出的$b_U(P)$依旧是一个独立的结构，其回答集依旧不受$(P \cup P') \backslash b_U(P)$影响。
	
	又在$Atoms(P') \cap U = \emptyset$及$Atoms(b_U(P)) \subseteq U$情况下，可以得到：	
	\begin{equation}
		(P \cup P') \backslash b_U(P) \equiv (P \backslash b_U(P)) \cup P'
	\end{equation}
	
	而$e_U(P,X)$操作中只会依旧条件删去与$U$有关的文字以保证$X$中的原子的真值确定性。所以在$Atoms(P') \cap U = \emptyset$情况下，$e_U(P,X)$不需要对$P'$操作，而$P'$所能推出的结论也不会干扰$P \backslash b_U(P)$或受其干扰，所以$e_U(P \backslash b_U(P),X) \cup P'$可以求解出$P \cup P'$的另一部分回答集。
	\quad
\end{proof}

然而，对于使用任意原子集作为分割集时，命题\ref{proposition_3_2}并不成立。但基于这个思想，为了继续扩展分割集理论对逻辑程序的结合律有效性，本节提出了强程序分割方法(Strong Splitting Method)。为此，本节对$SL_U(P,X)$进行了扩展。
\begin{definition}\label{SS_U_PX}
	给定析取逻辑程序$P$以及原子集$X$和$U$，标记以下原子集的集合：
	\begin{equation}
		\begin{array}{rcl}
			SS_U(P,X)~=~\{ E~|~E~\mbox{为}~U~\mbox{的任意非空子集，}~ \\
			E \subseteq X~\mbox{且}~R^-(E,P,X) \subseteq in_U(P) \}
		\end{array}		
	\end{equation}
\end{definition}

很直观地，$SS_U(P,X)$把$SL_U(P,X)$从$P$关于$U$的smei-loop扩展到$U$的任意非空子集。
同时，对任何满足$Atoms(P') \cap U = \emptyset$的析取逻辑程序$P'$，则$P' \cap in_U(P) = \emptyset$，故不会影响判断$E \subseteq X$和$R^-(E,P,X) \subseteq in_U(P)$等条件是否成立，
故其对$SL_U(P,X)$中的元素没有附加限制，
而且$SS_U(P,X)$中的$E$扩展为$U$的任意非空子集，
则可以得到$b_U(P \cup P') = b_U(P)$，且对任意的原子集$X$有$SL_U(P \cup P',X) \subseteq SS_U(P,X)$。
此外，若$U$是Lifschitz和Turner的分割理论定义下的分割集，则对任意原子集$X$都有$SS_U(P,X) = \emptyset$。
基于$SS_U(P,X)$，本节提出了析取逻辑程序$P$基于原子集$U$关于原子集$X$的强顶部。
\begin{definition}[强顶部] \label{strong_top}
	给定析取逻辑程序$P$以及原子集$X$和$U$，记$P$基于$U$关于$X$的强顶部(Strong Top)为$st_U(P,X)$，其由以下三部分组成：
	\begin{itemize}
		\item $P \backslash (b_U(P) \cup out_U(P)$，
		\item 对于每个$E \in SS_U(P,X)$构造$\{ \{x_E\} \cup head(r) \backslash E~\leftarrow~body(r)~|~r \in in_U(P)~\mbox{且} \\ r \in R^-(E,P,X) \}$，
		\item $\{ head(r)~\leftarrow~x_{E_1},x_{E_2},...,x_{E_t},body(r)~|~r \in out_U(P),~E_i \in SS_U(P,X)(1 \leq i \leq t)~\mbox{且}~body^+(r) \cap E_i \neq \emptyset \}$。
	\end{itemize}
\end{definition}

在给出$st_U(P,X)$后，本节定义一个析取逻辑程序$P$关于原子集$U$的强方案。
\begin{definition}[强方案] \label{strong_solution}
	给定析取逻辑程序$P$和原子集$U$，$P$关于$U$的强方案(Strong Solution)为一个原子集组合$\langle X,Y \rangle$，其中$X$和$Y$满足：
	\begin{itemize}
		\item $X$是$b_U(P) \cup EC_U(P)$的一个回答集；
		\item $Y$是$e_U(st_U(P,X),X) \cup ECC_U(P,X)$的一个回答集。
	\end{itemize}
\end{definition}

在有了强方案的定义后，依据$SS_U(P,X)$对$SL_U(P,X)$性质的扩展，可以得到以下两个定理。
\begin{theorem}\label{strong_splitting_theorem}
	给定析取逻辑程序$P$和原子集$U$。一个原子集$S$是$P$的一个回答集，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中$\langle X,Y \rangle$是$P$基于$U$的某组强方案。
\end{theorem}

定理\ref{strong_splitting_theorem}的正确性可以直接从定理\ref{new_d_splitting_theorem}的证明中得到。

\begin{theorem}\label{strong_associative}
	给定析取逻辑程序$P$和原子集$U$。另有逻辑程序$P'$满足$Atoms(P') \cap U = \emptyset$。则原子集$S$是$P \cup P'$的一个回答集，当且仅当$S = (X \cup Y) \cap Atoms(P)$，其中$X$为$b_U(P) \cup EC_U(P)$的某个回答集，$Y$为$e_U(st_U(P,X),X) \cup ECC_U(P,X) \cup P'$的某个回答集。
\end{theorem}

\begin{proof}
	由于$Atoms(P') \cap U = \emptyset$，所以$b_U(P \cup P') = b_U(P)$，故一样可以把$P \cup P'$通过$U$来分割，而不造成对$bottom$的影响，$P$只影响$top$部分。而$P'$的影响就是会造成原来在$P \backslash b_U(P)$中不是环的原子集变成了环，所以直接修改$SS_U(P,X)$为$U$中任意被破坏的非空子集。这些非空子集是可能因为$P'$而被构成环的。
	
	因为$Atoms(P') \cap U = \emptyset$，所以对$(P \cup P') \backslash b_U(P)$进行$st_U(P,X)$和$e_U(P,X)$操作的话，实际上$P'$中的规则不会被操作，这是因为$st_U(P,X)$只对与$E \subseteq U$有关的规则操作。
	且$Atoms(P') \cap U = \emptyset$，所以$Atoms(P') \cap E = \emptyset$，而$e_U(P,X)$只对与$U$相关的规则操作，所以也不会涉及$P'$中的规则。故只需对$P$执行$e_U(P,X)$操作，并在最后加上$P'$。
	
	所以对于$e_U(st_U(P,X),X) \cup ECC_U(P,X)$这部分，它保证了所有不被$X$满足的环公式的子集都被构造出相应的环，而且这些环会被满足，此外，去掉了$X$带来的原子真值确定性影响。在$e_U(st_U(P,X),X) \cup ECC_U(P,X)$中加入$P'$后求得的回答集$Y$与$X$结合就是这部分所能满足原程序所有环公式的回答集。\quad
\end{proof}

定理\ref{strong_associative}把程序分割方法的结合性扩展到以任意原子集作为分割集的情况。而这种结合性的本质是一个二次分割，这种扩展有助于新程序分割方法的递归使用问题研究。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{计算复杂性分析}

%上一节详细地给出了正规逻辑程序和析取逻辑程序的新程序分割方法，并证明了新的程序分割方法对任意原子集构成的分割集都有效。任意原子集给了程序分割很大的自由度，但这更多是理论层面的。
%本节将分析分割集如何影响程序分割过程的计算复杂性，并指出符合哪些条件的原子集作为分割集才会让程序分割更高效。本节以正规逻辑程序在程序分割方法上的计算复杂性为例进行分析。
本节以正规逻辑程序在程序分割方法上的计算复杂性为例进行分析。将先给出程序分割方法各个部分的规则集合的计算时间复杂度。
然后分析分割集如何影响程序分割过程的计算复杂性，并指出符合哪些条件的原子集作为分割集才会让程序分割更高效。

\subsection{分割方法的计算时间复杂度}
程序分割方法涉及多个规则集合的计算，可以把这些相关的规则集合分为底部和顶部两部分进行分析，可以得到以下的结果：

底部部分：
\begin{itemize}
	\item $b_U(P)$的计算时间复杂度为：$O(N)$，其中$N=|P|$；
	\item $EC_U(P)$的计算时间复杂度为：$O(M)$，其中$M=|Atoms(b_U(P)) \backslash U|$；
\end{itemize}

顶部部分：
\begin{itemize}
	\item $in_U(P)$和$out_U(P)$的计算时间复杂度为：$O(N)$，其中$N=|P|$；
	\item $DSL_U(P,X)$的计算时间复杂度为：$O(M*2^C)$，其中$M=|U|$，$C=|head(in_U(P)) \cup body^+(out_U(P))|$；
	\item $t_U(P,X)$的计算时间复杂度为：$O(N_1)+O(N_2*M_1)+O(N_2*M_2)$，其中$N_1=|P|$，$N_2=|DSL_U(P,X)|$，$M_1=|R^-(E,P,X)|$，$M_2=|out_U(P)|$；
	\item $ECC_U(P,X)$的计算时间复杂度为：$O(N)$，其中$N=|Atoms(b_U(P)) \backslash U|$；
	\item $e_U(t_U(P,X),X)$的计算时间复杂度为：$O(N)$，其中$N=|t_U(P,X)|$。
\end{itemize}

可以看到


%%%  这里先给出具体的时间复杂度，然后基于时间复杂度，再指出耗时的点
对于一个正规逻辑程序$P$通过一个原子集$U$进行程序分割的过程中主要耗时的有两个地方，分别为$bottom$的$EC_U(P)$和$top$的$DSL_U(P,X)$所造成。
具体体现为以下两个问题：
\begin{enumerate}
	\item 在bottom中，$EC_U(P)$中的规则在最坏情况下会为$b_U (P) \cup EC_U(P)$带来 \\ $2^{|Atoms(b_U(P) \backslash U|}$个回答集；
	\item 在top中，$DSL_U(P,X)$中的半环为$dt_U(P)$引入的新原子$x_E$的数量会发生指数爆炸。
\end{enumerate}

接下来的小节将分别对上述两个问题进行具体的分析和给出改善的方案。


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{底部计算复杂性}

本节对第一个问题进行分析。$bottom$中的$EC_U(P)$是为了补充$Atoms(b_U(P)) \\ \backslash U$中的原子在回答集中的真值可能性而定义的，就是这种真值可能性的遍历行为导致了回答集的指数增多。
对于$EC_U(P)$带来的耗时，本节给出以下两个降低计算复杂性的措施：
\begin{itemize}
	\item 保证$|Atoms(b_U(P)) \backslash U|$足够小，最好是在某个常数值以内；
	\item 让分割集$U$中的原子能被逻辑程序$P$的每个回答集所满足。
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
第一个措施中，在$|Atoms(b_U(P)) \backslash U|$足够小的情况下，特别地，是保持在某个常数值以内的话，$2^{|Atoms(b_U(P)) \backslash U|}$的大小就会被限制，这样就能防止$bottom$部分的回答集数量因为引入的新原子而造成指数爆炸。此外，由于分割集能够是任意原子集，所以限制$|Atoms(b_U(P)) \backslash U|$的大小是具备可行性的。
	
第二个措施中，若能使得分割集$U$中的原子能被ASP逻辑程序$P$的每个回答集所满足，那么这在后续计算$top$部分的$dt_U(P)$时只需考虑$b_U(P) \cup EC_U(P)$中满足$U \subseteq X$的回答集$X$。这样就能剪枝掉一系列$X$，达到降低$dt_U(P)$的复杂性。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


需要明确的一点是，能被逻辑程序$P$的每个回答集所满足的原子集就是一个程序结论，其有独立的定义和算法，不需要求解出逻辑程序的所有回答集才能得到。所以找出这样的原子集去作为分割集是可行的。而这样的原子集也将给本文带来分割集应用的新思路。具体的应用场景将在第四章给出。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{顶部计算复杂性}
本小节主要对第二个问题进行分析。关于$top$部分中的$DSL_U(P,X)$，依据其定义可以知道其中的关键半环$E$与其所能代表的半环$E'$必须满足：
\begin{eqnarray}
	E \cap head(in_U(P)) = E' \cap head(in_U(P)) \\
	E \cap body^+(out_U(P)) = E' \cap body^+(out_U(P))
\end{eqnarray}

而关键半环是可以代表其他一般半环的，此外，半环本来是由一般的环交分割集而来，所以保证了不存在两个不同的关键半环可以同时代表一个一般半环的情况。故在关键半环的互斥性之下，关键半环的数量的理论最大值将由$head(in_U(P))$和$body^+(out_U(P))$的基所决定。

更具体地来说就是由$E \cap head(in_U(P))$和$E \cap body^+(out_U(P))$的可能情况数量所决定。设$n = |head(in_U(P))|$和$m = |body^+(out_U(P))|$，那么有：
\begin{equation}
	|E \cap head(in_U(P))|~\leq~\Sigma_{0 \leq i \leq n} C^i_n = 2^n
\end{equation}

同理，还有：
\begin{equation}
	|E \cap body^+(out_U(P))| \leq 2^m
\end{equation}

故可以得到：
\begin{equation} \label{dsl_u_px_size}
	|DSL_U(P,X)| \leq |E \cap head(in_U(P))| * |E \cap body^+(out_U(P))| \leq 2^n * 2^m
\end{equation}

从式\ref{dsl_u_px_size}可以明显地知道通过限制$|head(in_U(P))|$和$|body^+(out_U(P))|$的大小就可以限制$|DSL_U(P,X)|$的大小。
而根据$in_U(P)$和$out_U(P)$的定义，$|head(in_U(P))|$和 \\  $|body^+(out_U(P))|$的大小依旧可以通过分割集$U$的基来限制。
在限制$|DSL_U(P,X)|$的大小后，在$dt_U(P)$中的第二和第三部分中将会大量减少新原子$x_E$的引入。
进而降低top部分的程序规模，加快求解速度。
本质上，这是人为地减少了被分割集$U$破坏的环的数量。

上述的计算复杂性都是基于正规逻辑程序而进行的。而事实上，正规逻辑程序的程序分割的计算复杂性的相关结论可以应用于析取逻辑程序上。因为两者仅在规则头部的基上有所不同，且头部的原子关系仅为析取。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{本章小结}

本章首先给出了一个计算Lifschitz和Turner所定义的分割集的算法。
并分别为正规逻辑程序和析取逻辑程序定义了$top$中的关键部分：$t_U(P,X)$和$dlpt_U(P,X)$，
以及补充原子真值可能性的$EC_U(P)$和确保$X$中原子的真值确定性的$ECC_U(P,X)$，
以此构造出对任意原子集作为分割集都有效的新程序分割方法。同时，基于环理论，提出了一个具有代表性的关键半环集的定义，并给出了具有工程意义的求解半环集的方法。
最后给出了强程序分割方法。

此外，本章还对新程序分割方法的计算复杂性进行了分析，并根据主要耗时的点，逐一给出了改进的方案。


